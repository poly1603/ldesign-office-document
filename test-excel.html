<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Excel Renderer Test - æ ·å¼é¢„è§ˆæµ‹è¯•</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f5f5;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      padding: 20px;
    }
    
    h1 {
      color: #333;
      margin-bottom: 20px;
      border-bottom: 2px solid #4CAF50;
      padding-bottom: 10px;
    }
    
    .controls {
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    input[type="file"] {
      padding: 10px;
      border: 2px dashed #4CAF50;
      border-radius: 5px;
      background: #f9f9f9;
      cursor: pointer;
      flex: 1;
      min-width: 200px;
    }
    
    input[type="file"]:hover {
      background: #e8f5e9;
    }
    
    button {
      padding: 10px 20px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.3s;
    }
    
    button:hover {
      background: #45a049;
    }
    
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    
    .viewer-container {
      width: 100%;
      height: 600px;
      border: 1px solid #ddd;
      border-radius: 5px;
      overflow: hidden;
      position: relative;
    }
    
    #status {
      margin-top: 10px;
      padding: 10px;
      border-radius: 5px;
      font-size: 14px;
    }
    
    .status-info {
      background: #e3f2fd;
      color: #1976d2;
    }
    
    .status-success {
      background: #e8f5e9;
      color: #388e3c;
    }
    
    .status-error {
      background: #ffebee;
      color: #c62828;
    }
    
    .test-info {
      margin-top: 20px;
      padding: 15px;
      background: #fff3e0;
      border-left: 4px solid #ff9800;
      border-radius: 4px;
    }
    
    .test-info h3 {
      margin-top: 0;
      color: #e65100;
    }
    
    .test-info ul {
      margin: 10px 0;
      padding-left: 20px;
    }
    
    .test-info li {
      margin: 5px 0;
      color: #666;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ¯ Excel æ–‡ä»¶é¢„è§ˆæµ‹è¯• - æ ·å¼å®Œæ•´å±•ç¤º</h1>
    
    <div class="controls">
      <input type="file" id="fileInput" accept=".xlsx,.xls" />
      <button id="loadBtn">åŠ è½½æ–‡ä»¶</button>
      <button id="createTestBtn">åˆ›å»ºæµ‹è¯•Excel</button>
    </div>
    
    <div id="status"></div>
    
    <div id="viewer-container" class="viewer-container"></div>
    
    <div class="test-info">
      <h3>ğŸ“‹ æµ‹è¯•è¯´æ˜</h3>
      <ul>
        <li><strong>æ ·å¼æ”¯æŒï¼š</strong>å­—ä½“ï¼ˆç²—ä½“ã€æ–œä½“ã€ä¸‹åˆ’çº¿ã€åˆ é™¤çº¿ï¼‰ã€é¢œè‰²ã€èƒŒæ™¯è‰²</li>
        <li><strong>æ ¼å¼æ”¯æŒï¼š</strong>æ•°å­—æ ¼å¼ã€æ—¥æœŸæ ¼å¼ã€è´§å¸æ ¼å¼ã€ç™¾åˆ†æ¯”æ ¼å¼</li>
        <li><strong>å•å…ƒæ ¼ç‰¹æ€§ï¼š</strong>åˆå¹¶å•å…ƒæ ¼ã€è¡Œé«˜åˆ—å®½ã€è¾¹æ¡†æ ·å¼</li>
        <li><strong>é«˜çº§åŠŸèƒ½ï¼š</strong>å…¬å¼è®¡ç®—ã€è¶…é“¾æ¥ã€å¯Œæ–‡æœ¬ã€å†»ç»“çª—æ ¼</li>
        <li><strong>å¯¹é½æ–¹å¼ï¼š</strong>æ°´å¹³å¯¹é½ï¼ˆå·¦ã€ä¸­ã€å³ï¼‰ã€å‚ç›´å¯¹é½ã€æ–‡å­—æ—‹è½¬ã€ç¼©è¿›</li>
      </ul>
    </div>
  </div>
  
  <script type="module">
    import { ExcelViewer } from './dist/index.esm.js';
    
    let viewer = null;
    
    function updateStatus(message, type = 'info') {
      const status = document.getElementById('status');
      status.textContent = message;
      status.className = `status-${type}`;
    }
    
    async function loadFile(file) {
      const container = document.getElementById('viewer-container');
      
      // Clear previous viewer
      if (viewer) {
        viewer.destroy();
        viewer = null;
      }
      container.innerHTML = '';
      
      updateStatus('æ­£åœ¨åŠ è½½æ–‡ä»¶...', 'info');
      
      try {
        viewer = new ExcelViewer({
          excel: {
            showGridLines: true,
            showFormulaBar: true,
            enableEditing: false
          },
          onLoad: () => {
            updateStatus(`æ–‡ä»¶åŠ è½½æˆåŠŸ: ${file.name}`, 'success');
          },
          onError: (error) => {
            updateStatus(`åŠ è½½å¤±è´¥: ${error.message}`, 'error');
            console.error('Error:', error);
          }
        });
        
        const arrayBuffer = await file.arrayBuffer();
        await viewer.render(container, arrayBuffer);
      } catch (error) {
        updateStatus(`æ¸²æŸ“å¤±è´¥: ${error.message}`, 'error');
        console.error('Render error:', error);
      }
    }
    
    // File input handler
    document.getElementById('loadBtn').addEventListener('click', () => {
      const fileInput = document.getElementById('fileInput');
      const file = fileInput.files[0];
      
      if (!file) {
        updateStatus('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªExcelæ–‡ä»¶', 'error');
        return;
      }
      
      loadFile(file);
    });
    
    // Auto-load on file selection
    document.getElementById('fileInput').addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        loadFile(file);
      }
    });
    
    // Create test Excel file
    document.getElementById('createTestBtn').addEventListener('click', async () => {
      updateStatus('æ­£åœ¨åˆ›å»ºæµ‹è¯•æ–‡ä»¶...', 'info');
      
      try {
        // Import ExcelJS for creating test file
        const ExcelJS = (await import('exceljs')).default;
        
        const workbook = new ExcelJS.Workbook();
        const sheet = workbook.addWorksheet('æ ·å¼æµ‹è¯•');
        
        // Set column widths
        sheet.columns = [
          { width: 15 },
          { width: 20 },
          { width: 15 },
          { width: 25 },
          { width: 15 }
        ];
        
        // Title with merged cells
        sheet.mergeCells('A1:E1');
        const titleCell = sheet.getCell('A1');
        titleCell.value = 'Excel æ ·å¼å±•ç¤ºæµ‹è¯•';
        titleCell.font = { name: 'Arial', size: 16, bold: true, color: { argb: 'FFFFFFFF' } };
        titleCell.fill = {
          type: 'pattern',
          pattern: 'solid',
          fgColor: { argb: 'FF4472C4' }
        };
        titleCell.alignment = { horizontal: 'center', vertical: 'middle' };
        sheet.getRow(1).height = 30;
        
        // Headers
        const headers = ['ç±»åˆ«', 'ç¤ºä¾‹å†…å®¹', 'æ•°å€¼', 'æ ¼å¼åŒ–', 'å¤‡æ³¨'];
        const headerRow = sheet.getRow(3);
        headers.forEach((header, index) => {
          const cell = headerRow.getCell(index + 1);
          cell.value = header;
          cell.font = { bold: true, color: { argb: 'FF000000' } };
          cell.fill = {
            type: 'pattern',
            pattern: 'solid',
            fgColor: { argb: 'FFE7E6E6' }
          };
          cell.border = {
            top: { style: 'thin' },
            left: { style: 'thin' },
            bottom: { style: 'medium' },
            right: { style: 'thin' }
          };
        });
        headerRow.height = 25;
        
        // Font styles
        sheet.getCell('A4').value = 'å­—ä½“æ ·å¼';
        sheet.getCell('B4').value = 'ç²—ä½“æ–‡æœ¬';
        sheet.getCell('B4').font = { bold: true };
        
        sheet.getCell('B5').value = 'æ–œä½“æ–‡æœ¬';
        sheet.getCell('B5').font = { italic: true };
        
        sheet.getCell('B6').value = 'ä¸‹åˆ’çº¿æ–‡æœ¬';
        sheet.getCell('B6').font = { underline: true };
        
        sheet.getCell('B7').value = 'åˆ é™¤çº¿æ–‡æœ¬';
        sheet.getCell('B7').font = { strike: true };
        
        // Colors
        sheet.getCell('A9').value = 'é¢œè‰²';
        sheet.getCell('B9').value = 'çº¢è‰²æ–‡å­—';
        sheet.getCell('B9').font = { color: { argb: 'FFFF0000' } };
        
        sheet.getCell('B10').value = 'è“è‰²èƒŒæ™¯';
        sheet.getCell('B10').fill = {
          type: 'pattern',
          pattern: 'solid',
          fgColor: { argb: 'FF4472C4' }
        };
        sheet.getCell('B10').font = { color: { argb: 'FFFFFFFF' } };
        
        // Numbers
        sheet.getCell('A12').value = 'æ•°å­—æ ¼å¼';
        sheet.getCell('C12').value = 1234.56;
        sheet.getCell('D12').value = 1234.56;
        sheet.getCell('D12').numFmt = '#,##0.00';
        
        sheet.getCell('C13').value = 0.125;
        sheet.getCell('D13').value = 0.125;
        sheet.getCell('D13').numFmt = '0.00%';
        
        sheet.getCell('C14').value = 1234.56;
        sheet.getCell('D14').value = 1234.56;
        sheet.getCell('D14').numFmt = '"Â¥"#,##0.00';
        
        // Dates
        const now = new Date();
        sheet.getCell('A16').value = 'æ—¥æœŸæ ¼å¼';
        sheet.getCell('C16').value = now;
        sheet.getCell('D16').value = now;
        sheet.getCell('D16').numFmt = 'yyyy-mm-dd';
        
        // Formula
        sheet.getCell('A18').value = 'å…¬å¼';
        sheet.getCell('C18').value = 10;
        sheet.getCell('C19').value = 20;
        sheet.getCell('C20').value = { formula: 'C18+C19', result: 30 };
        sheet.getCell('D20').value = '=C18+C19';
        
        // Alignment
        sheet.getCell('A22').value = 'å¯¹é½æ–¹å¼';
        sheet.mergeCells('B22:D22');
        const alignCell = sheet.getCell('B22');
        alignCell.value = 'å±…ä¸­å¯¹é½';
        alignCell.alignment = { horizontal: 'center', vertical: 'middle' };
        alignCell.fill = {
          type: 'pattern',
          pattern: 'solid',
          fgColor: { argb: 'FFFFF2CC' }
        };
        
        // Border styles
        const borderRange = 'B24:D26';
        sheet.getCell('A24').value = 'è¾¹æ¡†æ ·å¼';
        sheet.getCell('B24').value = 'ç»†è¾¹æ¡†';
        sheet.getCell('B24').border = {
          top: { style: 'thin' },
          left: { style: 'thin' },
          bottom: { style: 'thin' },
          right: { style: 'thin' }
        };
        
        sheet.getCell('C24').value = 'ç²—è¾¹æ¡†';
        sheet.getCell('C24').border = {
          top: { style: 'thick', color: { argb: 'FF0000FF' } },
          left: { style: 'thick', color: { argb: 'FF0000FF' } },
          bottom: { style: 'thick', color: { argb: 'FF0000FF' } },
          right: { style: 'thick', color: { argb: 'FF0000FF' } }
        };
        
        sheet.getCell('D24').value = 'åŒçº¿è¾¹æ¡†';
        sheet.getCell('D24').border = {
          top: { style: 'double' },
          left: { style: 'double' },
          bottom: { style: 'double' },
          right: { style: 'double' }
        };
        
        // Generate file
        const buffer = await workbook.xlsx.writeBuffer();
        const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
        
        // Create virtual file for loading
        const file = new File([blob], 'test-styles.xlsx', { type: blob.type });
        await loadFile(file);
        
        // Also offer download
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'test-styles.xlsx';
        a.click();
        URL.revokeObjectURL(url);
        
        updateStatus('æµ‹è¯•æ–‡ä»¶å·²åˆ›å»ºå¹¶åŠ è½½', 'success');
      } catch (error) {
        updateStatus(`åˆ›å»ºæµ‹è¯•æ–‡ä»¶å¤±è´¥: ${error.message}`, 'error');
        console.error('Create test file error:', error);
      }
    });
    
    // Initial status
    updateStatus('è¯·é€‰æ‹©Excelæ–‡ä»¶æˆ–åˆ›å»ºæµ‹è¯•æ–‡ä»¶', 'info');
  </script>
</body>
</html>